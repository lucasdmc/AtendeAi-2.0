# =====================================================
# CONFIGURAÇÕES ADICIONAIS KONG - SERVIÇOS RESTANTES
# ATENDEAI 2.0 - ENTREGÁVEL 1
# =====================================================

_format_version: "2.1"
_transform: true

services:
  # =====================================================
  # CONVERSATION SERVICE
  # =====================================================
  - name: conversation-service
    url: http://conversation-service:3005
    routes:
      - name: conversations-api
        paths:
          - /api/v1/conversations
        methods:
          - GET
          - POST
          - PUT
          - DELETE
        strip_path: false
        plugins:
          - name: rate-limiting
            config:
              minute: 50
              hour: 500
              policy: local
          - name: cors
            config:
              origins: ["*"]
              methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
              headers: ["Content-Type", "Authorization", "X-Clinic-ID"]
              exposed_headers: ["Authorization", "X-Clinic-ID"]
              credentials: true
              max_age: 3600

  # =====================================================
  # APPOINTMENT SERVICE
  # =====================================================
  - name: appointment-service
    url: http://appointment-service:3006
    routes:
      - name: appointments-api
        paths:
          - /api/v1/appointments
        methods:
          - GET
          - POST
          - PUT
          - DELETE
        strip_path: false
        plugins:
          - name: rate-limiting
            config:
              minute: 40
              hour: 400
              policy: local
          - name: cors
            config:
              origins: ["*"]
              methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
              headers: ["Content-Type", "Authorization", "X-Clinic-ID"]
              exposed_headers: ["Authorization", "X-Clinic-ID"]
              credentials: true
              max_age: 3600

  # =====================================================
  # WHATSAPP SERVICE
  # =====================================================
  - name: whatsapp-service
    url: http://whatsapp-service:3007
    routes:
      - name: whatsapp-webhook
        paths:
          - /webhook/whatsapp
        methods:
          - POST
          - GET
        strip_path: false
        plugins:
          - name: rate-limiting
            config:
              minute: 100
              hour: 1000
              policy: local
          - name: cors
            config:
              origins: ["*"]
              methods: ["POST", "GET", "OPTIONS"]
              headers: ["Content-Type", "X-Hub-Signature"]
              exposed_headers: []
              credentials: false
              max_age: 3600

      - name: whatsapp-api
        paths:
          - /api/v1/whatsapp
        methods:
          - GET
          - POST
          - PUT
          - DELETE
        strip_path: false
        plugins:
          - name: rate-limiting
            config:
              minute: 60
              hour: 600
              policy: local
          - name: cors
            config:
              origins: ["*"]
              methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
              headers: ["Content-Type", "Authorization", "X-Clinic-ID"]
              exposed_headers: ["Authorization", "X-Clinic-ID"]
              credentials: true
              max_age: 3600

  # =====================================================
  # GOOGLE CALENDAR SERVICE
  # =====================================================
  - name: google-calendar-service
    url: http://google-calendar-service:3008
    routes:
      - name: calendar-api
        paths:
          - /api/v1/calendar
        methods:
          - GET
          - POST
          - PUT
          - DELETE
        strip_path: false
        plugins:
          - name: rate-limiting
            config:
              minute: 30
              hour: 300
              policy: local
          - name: cors
            config:
              origins: ["*"]
              methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
              headers: ["Content-Type", "Authorization", "X-Clinic-ID"]
              exposed_headers: ["Authorization", "X-Clinic-ID"]
              credentials: true
              max_age: 3600

# =====================================================
# PLUGINS ADICIONAIS
# =====================================================
plugins:
  # =====================================================
  # IP RESTRICTION (OPCIONAL)
  # =====================================================
  - name: ip-restriction
    config:
      allow: ["0.0.0.0/0"]
      message: "Access denied for your IP address"

  # =====================================================
  # REQUEST SIZE LIMITING
  # =====================================================
  - name: request-size-limiting
    config:
      allowed_payload_size: 10485760  # 10MB

  # =====================================================
  # REQUEST TERMINATION (PARA TESTES)
  # =====================================================
  - name: request-termination
    config:
      status_code: 503
      message: "Service temporarily unavailable"
    enabled: false  # Desabilitado por padrão
